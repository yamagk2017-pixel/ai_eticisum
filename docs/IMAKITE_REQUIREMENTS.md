# IMAKITE RANKING（IMAKITE）機能要件まとめ（ドラフト）

## 1. 目的・コンセプト
- IMDBを軸にしたアイドル専門情報サイトの第二弾として、「いま来てる」指標を可視化する。
- プロジェクト名は **IMAKITE RANKING**、プロジェクトコードは **ihc**。
- `/imakite` で **ihc.daily_top20** を中心に、最新ランキングと過去アーカイブを提供する。

---

## 2. 対象データ（入力）
### 2.1 データソース
- `ihc.daily_top20` を主データとして利用。
- `group_id` は **imd.groups.id** とリンクする。
- IMDBのグループ基本情報と突合して表示（グループ名・画像等）。

### 2.2 `ihc.daily_top20` スキーマ（判明分）
- `snapshot_date` (date)
- `group_id` (uuid)
- `rank` (int4)
- `artist_name` (text)
- `score` (numeric)
- `latest_track_name` (text)
- `latest_track_embed_link` (text) - Spotify埋め込みリンク
- `artist_image_url` (text)
- `created_at` (timestamptz)

例: Spotify埋め込みリンク
```text
https://open.spotify.com/embed/track/2CDZa6XiId5brsaFznd45N
```

### 2.3 データ粒度
- 日次ランキング（daily）。
- 上位20件（Top20）。

---

## 3. /imakite（トップページ）
### 3.1 最新ランキング表示
- **当日分のTop20** を表示。
- ランキングは `score` の降順で決定。
- 各行に以下を表示：
  - 順位
  - グループ名（IMDB連携）
  - 指標値（`score`：IMAKITE RANKING の日次獲得スコア）
  - 変動は表示しない

### 3.2 UI上の補足
- 「IMAKITE = いま来てる指標」であることを明示。
- 指標の解釈を短く説明（例：「SNSと外部データを元にした当日ランキング」等）。

---

## 4. アーカイブ閲覧
### 4.1 日付別アーカイブ
- 過去日付のランキングを参照できる。
- アーカイブ一覧は日付ベースで並べる（最新が上）。

### 4.2 アーカイブアクセス方法
- アーカイブ一覧ページは `/imakite/archive`。
- 日付別ランキング詳細は `/imakite/ranking/YYYY-MM-DD`。

### 4.3 アーカイブ導線
- `/imakite` に「過去のランキングを見る」リンクを表示。
- アーカイブページでは `YYYY年MM月DD日` を一覧表示。
- 日付クリックで、その日のランキングページへ遷移（例: `/imakite/ranking/2026-02-04`）。

## 5. 管理（ランキング取り込み）
### 5.1 管理ページ
- 管理画面は `/imakite/admin`。
- 画面に **カレンダー** と **「ランキングデータ取得」ボタン** を表示。

### 5.2 初期表示時の挙動
- `/imakite/admin` へアクセスしたら `ihc.daily_top20.snapshot_date` の最新日を取得。
- 取得した最新日をカレンダーに表示（選択済みの状態）。

### 5.3 取り込み処理
- 「ランキングデータ取得」ボタン押下で、選択日のランキングデータを取得。
- 取得後、`/imakite` に最新のランキング Top20 を生成。
- アーカイブは `ihc.daily_top20` の過去データから自動生成する（移行処理は不要）。

---

## 5. グループ詳細への導線
- 各ランキング行からグループページへ遷移可能。
- IMDB側の個別ページに遷移（他プロジェクトとの統合を想定）。

---

## 6. 更新タイミング
- `ihc.daily_top20` の更新サイクルに合わせて反映。
- UI上で **対象日** を明示（例：「2026-02-05 のランキング」）。

---

## 7. 表示要素（最低限）
- 日付
- 順位
- グループ名
- 指標値（`score`）
- グループ詳細リンク

## 9. 表示要件（確定）
### 9.1 ランキング表示項目
- 日付（`YYYY年MM月DD日付`）
- ランキング（1〜20）
- アーティスト名
- アーティスト画像
- スコア（小数点2位まで）
- 曲名
- Spotify埋め込み

### 9.2 フォーマット補足
- 日付は日本語表記（例: `2026年02月05日付`）。
- スコアは小数点以下2桁で表示（四捨五入）。

### 9.3 レイアウト指針
- 1位は大型カード。
- 2〜3位は中型カード。
- 4位以降は小型カード。

---

## 8. 未確定・要検討（ToDo）
- `ihc.daily_top20` のスキーマ詳細（フィールド名、scoreの意味）。
- 変動表示の算出方法（前日との差分：順位差分 or スコア差分）。
- 日次更新タイミングとキャッシュ方針。
- アーカイブ保存期間の上限（全日保持／一定期間のみ）。

## Backlog / Future ideas
- 週間／月間ランキングの派生。
- 日付比較UI（2日分の比較ビュー）。
- SNSシェア用OGカード生成（当日Top3表示など）。

---

## 10. Weekly（追加要件）
### 10.1 目的
- 月曜夜集計の週間ランキングを、日次と同格の主要導線として表示する。
- 週間ランキングのSpotifyプレイリストをページ上部に表示する。

### 10.2 画面/URL
- 最新週: `/imakite/weekly`
- 週次アーカイブ: `/imakite/weekly/archive`
- 週次詳細: `/imakite/weekly/ranking/YYYY-MM-DD`

### 10.3 導線
- `/imakite` と `/imakite/weekly` に `Daily / Weekly` タブを表示。
- 週次ページには「過去の週間ランキングを見る」リンクを表示。

### 10.4 表示内容
- 基本表示は日次と同じ（Top20カード、順位、アーティスト、スコア、曲名、Spotify埋め込み）。
- 週間ページはランキングリストの上に週間プレイリスト埋め込みを表示（データがある場合）。
